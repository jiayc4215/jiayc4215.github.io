import{_ as j}from"./chunks/el-form-renderer.1ac91fef.js";import{E as t,a as $}from"./chunks/index.b9d9a31e.js";import{a0 as q,h as B,M as P,g as x,x as N,C as v,o as c,c as r,H as u,a3 as I,w as A,a as E,F as h,k as d,t as _,e as T,l as g,O as H,_ as K,a2 as J,W as Q,Q as W}from"./chunks/framework.52b122f8.js";import"./chunks/commonjsHelpers.725317a4.js";const G={class:"component-upload-image"},X=["innerHTML"],Y={key:1},Z={style:{color:"#f56c6c"}},ss={style:{color:"#f56c6c"}},ns={__name:"ManualUpload",props:{modelValue:[String,Object,Array],action:{type:String,default:"/sys/user/import"},limit:{type:Number,default:5},fileSize:{type:Number,default:5},fileType:{type:Array,default:()=>["xls","xlsx"]},isShowTip:{type:Boolean,default:!0},name:{type:String,default:"file"},parentTip:{type:String,default:""}},emits:["update:modelValue"],setup(l,{expose:e,emit:y}){const n=l;let i=q([]),o=B(0),F=q({}),f=q({Authorization:"Bearer token"}),m=null;const C=B(""),b=P("uploaded"),k=x(()=>n.action),S=x(()=>n.isShowTip&&(n.fileType||n.fileSize));N(()=>n.modelValue,s=>{if(s){let a=1;i=(Array.isArray(s)?s:n.modelValue.split(",")).map(p=>(typeof p=="string"&&(p={name:p,url:p}),p.uid=p.uid||new Date().getTime()+a++,p))}else return i=[],[]},{deep:!0,immediate:!0});const w=s=>{if(n.fileType){let a="";if(s.name.lastIndexOf(".")>-1&&(a=s.name.slice(s.name.lastIndexOf(".")+1)),!n.fileType.some(p=>!!(s.type.indexOf(p)>-1||a&&a.indexOf(p)>-1)))return t({message:`文件格式不正确, 请上传${n.fileType.join(",")}格式文件!`,type:"error"}),!1}if(n.fileSize&&!(s.size/1024/1024<n.fileSize))return t({message:`上传文件大小不能超过 ${n.fileSize} MB!`,type:"error"}),!1;m=$.service({lock:!0,text:"正在上传文件，请稍候...",background:"rgba(0, 0, 0, 0.7)"}),o.value++},z=()=>{t({message:`上传文件数量不能超过 ${n.limit} 个!`,type:"error"})},M=s=>{b(s),t({message:"上传图片失败，请重试",type:"error"}),m.close()},U=async s=>{s={...s},await H(),C.value.submit()},L=(s,a)=>{y("update:modelValue",a)},R=(s,a)=>{y("update:modelValue",a)},V=(s,a)=>{console.log("上传成功的回调"),s.code===1e4?(m.close(),t({message:"上传成功",type:"success"})):s.code===401?t({message:"登录状态过期，请重新登录",type:"error"}):(o.value--,m.close(),t({message:"上传失败",type:"error"}),C.value.handleRemove(a)),b(s)},O=(s,a)=>{console.log(s)};return e({submitUpload:U}),(s,a)=>{const D=v("el-button"),p=v("el-upload");return c(),r("div",G,[u(p,{class:"upload-demo",ref_key:"upload",ref:C,action:k.value,"on-preview":O,name:l.name,limit:l.limit,data:{...g(F)},accept:l.fileType.join(","),"on-error":M,"on-exceed":z,"on-success":V,"before-upload":w,"on-change":R,"on-remove":L,"file-list":g(i),headers:g(f),"auto-upload":!1},I({trigger:A(()=>[u(D,{size:"small",type:"primary"},{default:A(()=>[E("选取文件")]),_:1})]),_:2},[S.value?{name:"tip",fn:A(()=>[l.parentTip?(c(),r("div",{key:0,innerHTML:l.parentTip},null,8,X)):(c(),r("div",Y,[E(" 请上传 "),l.fileSize?(c(),r(h,{key:0},[E(" 大小不超过 "),d("b",Z,_(l.fileSize)+"MB",1)],64)):T("",!0),l.fileType?(c(),r(h,{key:1},[E(" 格式为 "),d("b",ss,_(l.fileType.join(",")),1)],64)):T("",!0),E(" 的文件 ")]))]),key:"0"}:void 0]),1032,["action","name","limit","data","accept","file-list","headers"])])}}};const as={__name:"uploadFile",setup(l){const e=B(""),y=q([{label:"上传文件",component:J(ns),el:{limit:1,action:"/api/sys/user/import"},id:"file",rules:[{required:!0,message:"请选上传文件",trigger:"blur",type:"array"}]}]),n=o=>{o.code!==500&&console.log(o,"上传结果")},i=()=>{try{e.value.methods.validate(o=>{if(o){console.log("OK");let F=e.value.getFormValue();e.value.getComponentById("file").submitUpload(F),console.log(F)}else return console.log("error submit!!"),!1})}catch(o){console.log(o)}};return Q("uploaded",n),(o,F)=>{const f=v("el-button");return c(),r(h,null,[u(j,{ref_key:"formRender",ref:e,content:y},null,8,["content"]),u(f,{size:"small",type:"primary",onClick:i},{default:A(()=>[E("提交")]),_:1})],64)}}},ls=K(as,[["__scopeId","data-v-6f89139a"]]),ps=d("h1",{id:"basic",tabindex:"-1"},[E("basic "),d("a",{class:"header-anchor",href:"#basic","aria-label":'Permalink to "basic"'},"​")],-1),os=d("br",null,null,-1),es=W("",7),is=JSON.parse('{"title":"basic","description":"","frontmatter":{},"headers":[],"relativePath":"assembly/advanced/uploadFile.md","filePath":"assembly/advanced/uploadFile.md"}'),ts={name:"assembly/advanced/uploadFile.md"},Fs=Object.assign(ts,{setup(l){return(e,y)=>(c(),r("div",null,[ps,os,u(ls),es]))}});export{is as __pageData,Fs as default};
