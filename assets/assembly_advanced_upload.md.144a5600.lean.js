import{_ as P}from"./chunks/el-form-renderer.1ac91fef.js";import{p as $,E as c,a as N}from"./chunks/index.b9d9a31e.js";import{_ as k,a0 as A,h as f,g as w,x as H,C as B,o as q,c as D,H as e,w as d,k as r,a as E,F as h,t as L,e as S,l as u,n as J,a1 as Q,a2 as G,Q as K}from"./chunks/framework.52b122f8.js";import"./chunks/commonjsHelpers.725317a4.js";const W={class:"component-upload-image"},X={style:{color:"#f56c6c"}},Y={style:{color:"#f56c6c"}},Z=["src"],ss={__name:"ImageUpload",props:{modelValue:[String,Object,Array],action:{type:String,default:"/dev-api/admin/product/fileUpload"},extralData:{type:Object,default:()=>({})},limit:{type:Number,default:5},fileSize:{type:Number,default:5},fileType:{type:Array,default:()=>["png","jpg","jpeg"]},isShowTip:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(o,{emit:t}){const n=o;let y=A([]),i=f(0),p=A([]),v=A({Authorization:"Bearer 1111"}),m=f(""),g=f(!1),C=null;const V=A({a:1}),b=f("");w(()=>n.isShowTip&&(n.fileType||n.fileSize)),H(()=>n.modelValue,s=>{if(console.log("watch触发",s),s)p=(Array.isArray(s)?s:Array.isArray(n.modelValue.split(","))?n.modelValue.split(","):Array.of(n.modelValue)).map(a=>(typeof a=="string"&&(a={name:a,url:a}),a)),console.log(p,"数据回显fileList");else return p=[],[]});const T=(s,l)=>{t("update:modelValue",x(p))},U=w(()=>n.action),j=(s,l)=>{s.code===200?(y.push({name:s.data,url:s.data}),y.length===i.value&&(p=p.concat(y),y=[],i.value=0,t("update:modelValue",x(p)),C.close()),C.close(),c({message:"上传成功",type:"success"})):s.code===401?c({message:"登录状态过期，请重新登录",type:"error"}):(i.value--,C.close(),c({message:"上传失败",type:"error"}),b.value.handleRemove(l))},I=s=>{let l=!1;if(n.fileType.length){let a="";s.name.lastIndexOf(".")>-1&&(a=s.name.slice(s.name.lastIndexOf(".")+1)),l=n.fileType.some(F=>s.type.indexOf(F)>-1?!0:!!(a&&a.indexOf(F)>-1))}else l=s.type.indexOf("image")>-1;if(!l)return c({message:`文件格式不正确, 请上传${n.fileType.join("/")}图片格式文件!`,type:"error"}),!1;if(n.fileSize&&!(s.size/1024/1024<n.fileSize))return c({message:`上传图片大小不能超过 ${n.fileSize} MB!`,type:"error"}),!1;C=N.service({lock:!0,text:"正在上传图片，请稍候...",background:"rgba(0, 0, 0, 0.7)"}),i.value++},x=(s,l)=>{let a="";l=l||",";for(let F in s)a+=s[F].url+l;return a!==""?a.substr(0,a.length-1):""},z=s=>{console.log(s),c({message:"上传图片失败，请重试",type:"error"}),C.close()},M=()=>{c({message:`上传文件数量不能超过 ${n.limit} 个!`,type:"error"})},R=s=>{m.value=s.url,g.value=!0};return(s,l)=>{const a=B("el-icon"),F=B("el-upload"),O=B("el-dialog");return q(),D("div",W,[e(F,{ref_key:"upload",ref:b,disabled:o.disabled,multiple:"",action:U.value,"list-type":"picture-card","on-success":j,"before-upload":I,limit:o.limit,"on-error":z,"on-exceed":M,data:{...V,...o.extralData},name:"file","on-remove":T,"show-file-list":!0,headers:u(v),"file-list":u(p),"on-preview":R,class:J({hide:u(p).length>=o.limit})},{tip:d(()=>[r("div",null,[E(" 请上传 "),o.fileSize?(q(),D(h,{key:0},[E(" 大小不超过 "),r("b",X,L(o.fileSize)+"MB",1)],64)):S("",!0),o.fileType?(q(),D(h,{key:1},[E(" 格式为 "),r("b",Y,L(o.fileType.join("/")),1)],64)):S("",!0),E(" 的文件 ")])]),default:d(()=>[e(a,{class:"avatar-uploader-icon"},{default:d(()=>[e(u($))]),_:1})]),_:1},8,["disabled","action","limit","data","headers","file-list","class"]),e(O,{modelValue:u(g),"onUpdate:modelValue":l[0]||(l[0]=_=>Q(g)?g.value=_:g=_),title:"预览",width:"800","append-to-body":""},{default:d(()=>[r("img",{src:u(m),style:{display:"block","max-width":"100%",margin:"0 auto"}},null,8,Z)]),_:1},8,["modelValue"])])}}},ns=k(ss,[["__scopeId","data-v-fe4b35f2"]]);const as={__name:"upload",setup(o){const t=f(""),n=A([{label:"图片上传",component:G(ns),el:{isShowTip:!1,limit:2,extralData:{type:"identityBack"}},id:"identityBack",rules:[{required:!0,message:"请选择门头照",trigger:"blur"}]}]),y=()=>{const p=t.value.getFormValue();console.log(p)},i=()=>{t.value.updateForm({identityBack:"https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100,https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100"})};return(p,v)=>{const m=B("el-button");return q(),D(h,null,[e(P,{ref_key:"formRender",ref:t,content:n},null,8,["content"]),e(m,{onClick:y},{default:d(()=>[E("获取图片地址")]),_:1}),e(m,{onClick:i},{default:d(()=>[E("设置图片地址")]),_:1})],64)}}},ls=k(as,[["__scopeId","data-v-487086a9"]]),ps=r("h1",{id:"basic",tabindex:"-1"},[E("basic "),r("a",{class:"header-anchor",href:"#basic","aria-label":'Permalink to "basic"'},"​")],-1),os=r("br",null,null,-1),es=K("",7),is=JSON.parse('{"title":"basic","description":"","frontmatter":{},"headers":[],"relativePath":"assembly/advanced/upload.md","filePath":"assembly/advanced/upload.md"}'),ts={name:"assembly/advanced/upload.md"},Fs=Object.assign(ts,{setup(o){return(t,n)=>(q(),D("div",null,[ps,os,e(ls),es]))}});export{is as __pageData,Fs as default};
